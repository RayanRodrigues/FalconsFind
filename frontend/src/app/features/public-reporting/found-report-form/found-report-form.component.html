<div class="min-h-screen bg-neutral-base py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-semibold text-primary mb-2">Report Found Item</h1>
      <p class="text-text-secondary">Share details so Campus Security can validate and publish safely.</p>
    </div>

    @if (submitSuccess) {
      <app-card>
        <div class="text-center py-8">
          <svg
            class="w-16 h-16 text-success mx-auto mb-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z"
            />
          </svg>
          <h2 class="text-2xl font-semibold text-success mb-4">Found Report Submitted</h2>
          <p class="text-lg mb-2">Reference code:</p>
          <p class="text-3xl font-bold text-primary mb-6">{{ referenceCode }}</p>
          <div class="flex gap-4 justify-center">
            <app-button variant="primary" (click)="resetForm()">Submit Another Report</app-button>
            <app-button variant="secondary" (click)="navigateHome()">Return to Home</app-button>
          </div>
        </div>
      </app-card>
    }

    @if (submitError && !submitSuccess) {
      <div class="mb-6">
        <app-alert type="error" [dismissible]="true">
          <strong class="block mb-1">Could not submit found report</strong>
          <p class="text-sm">{{ submitError }}</p>
        </app-alert>
      </div>
    }

    @if (!submitSuccess) {
      <app-card cardTitle="Found Item Report" subtitle="Photo and location are required">
        <form [formGroup]="foundForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <div class="grid grid-cols-3 gap-2">
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 1 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg class="h-4 w-4 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-8.25A2.25 2.25 0 0 0 17.25 3.75H6.75A2.25 2.25 0 0 0 4.5 6v12A2.25 2.25 0 0 0 6.75 20.25h6.75" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 8.25h7.5M8.25 11.25h7.5M8.25 14.25h4.5" />
                </svg>
                <span>Basic Info</span>
              </span>
            </button>
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 2 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg class="h-4 w-4 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3.75v3M17.25 3.75v3M3.75 9.75h16.5" />
                  <rect x="3.75" y="5.25" width="16.5" height="15" rx="2.25" ry="2.25"></rect>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 13.5h3.75" />
                </svg>
                <span>Time & Place</span>
              </span>
            </button>
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 3 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg class="h-4 w-4 shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6.75a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.5 19.5a7.5 7.5 0 0 1 15 0" />
                </svg>
                <span>Contact</span>
              </span>
            </button>
          </div>

          <p class="text-sm text-text-secondary"><span class="text-red-500">*</span> Required fields</p>

          @if (currentStep === 1) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">Basic Information</h3>

              <app-form-field id="title" label="Item Title" [required]="true" [error]="getFieldError('title')">
                <app-input
                  id="title"
                  formControlName="title"
                  placeholder="e.g., Silver Water Bottle"
                  [invalid]="isFieldInvalid('title')"
                />
              </app-form-field>

              <app-form-field id="description" label="Description" [required]="true" [error]="getFieldError('description')">
                <app-textarea
                  id="description"
                  formControlName="description"
                  [rows]="4"
                  placeholder="Describe color, brand, and identifying details"
                  [invalid]="isFieldInvalid('description')"
                />
                <span hint class="text-xs text-text-secondary">
                  {{ foundForm.get('description')?.value?.length || 0 }}/500 characters
                </span>
              </app-form-field>
            </div>
          }

          @if (currentStep === 2) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">When and Where</h3>

              <app-form-field
                id="foundLocation"
                label="Found Location"
                [required]="true"
                [error]="getFieldError('foundLocation')"
              >
                <app-input
                  id="foundLocation"
                  formControlName="foundLocation"
                  placeholder="e.g., Library, 2nd floor"
                  [invalid]="isFieldInvalid('foundLocation')"
                />
              </app-form-field>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <app-form-field id="foundDate" label="Date Found" [required]="true" [error]="getFieldError('foundDate')">
                  <app-input
                    id="foundDate"
                    type="date"
                    formControlName="foundDate"
                    [max]="todayDate"
                    [invalid]="isFieldInvalid('foundDate')"
                  />
                </app-form-field>

                <app-form-field id="foundTime" label="Approximate Time" [required]="true" [error]="getFieldError('foundTime')">
                  <app-input
                    id="foundTime"
                    type="time"
                    formControlName="foundTime"
                    [invalid]="isFieldInvalid('foundTime')"
                  />
                </app-form-field>
              </div>

              <app-form-field id="photo" label="Photo" [required]="true" [error]="getFieldError('photo')">
                <div class="relative border-2 border-dashed border-border rounded-lg bg-bg-secondary hover:border-primary hover:bg-primary/5 transition-all duration-200">
                  <input
                    id="photo"
                    type="file"
                    accept="image/jpeg,image/png,image/jpg"
                    (change)="onFileSelected($event)"
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
                  />
                  @if (foundForm.get('photo')?.value && photoPreviewUrl) {
                    <div class="p-4">
                      <div class="flex items-center gap-2 text-success font-medium text-sm mb-3">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z" />
                        </svg>
                        Photo uploaded
                      </div>
                      <div class="flex items-center gap-4">
                        <img [src]="photoPreviewUrl" alt="Selected photo preview" class="w-20 h-20 rounded-md object-cover border border-border" />
                        <div class="min-w-0">
                          <p class="text-sm text-text-primary truncate">{{ foundForm.get('photo')?.value?.name }}</p>
                          <p class="text-xs text-text-secondary">Click this area to replace image</p>
                        </div>
                      </div>
                    </div>
                  } @else {
                    <div class="text-center py-8">
                      <svg class="w-8 h-8 text-text-secondary mx-auto mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5V8.25a2.25 2.25 0 0 1 2.25-2.25h2.379a1.5 1.5 0 0 0 1.06-.44l.622-.62a1.5 1.5 0 0 1 1.06-.44h3.258a1.5 1.5 0 0 1 1.06.44l.622.62a1.5 1.5 0 0 0 1.06.44h2.379A2.25 2.25 0 0 1 21 8.25v8.25A2.25 2.25 0 0 1 18.75 18.75H5.25A2.25 2.25 0 0 1 3 16.5Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                      </svg>
                      <span class="font-medium text-text-primary">Click to upload or drag and drop</span>
                      <span class="text-xs text-text-secondary block mt-1">JPEG, PNG up to 5MB</span>
                    </div>
                  }
                </div>
              </app-form-field>
            </div>
          }

          @if (currentStep === 3) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">Contact Information</h3>
              <p class="text-sm text-text-secondary">Optional. Helps campus security contact you quickly.</p>

              <app-form-field id="contactEmail" label="Email Address" [error]="getFieldError('contactEmail')">
                <app-input
                  id="contactEmail"
                  type="email"
                  formControlName="contactEmail"
                  placeholder="your.name@fanshaweonline.ca"
                  [invalid]="isFieldInvalid('contactEmail')"
                />
              </app-form-field>
            </div>
          }

          <div class="flex flex-row justify-end gap-3 pt-6 border-t border-border">
            <app-button type="button" variant="secondary" (click)="navigateHome()" [disabled]="isSubmitting">
              Cancel
            </app-button>
            @if (currentStep > 1) {
              <app-button type="button" variant="secondary" (click)="previousStep()" [disabled]="isSubmitting">
                Back
              </app-button>
            }
            @if (currentStep < totalSteps) {
              <app-button type="button" variant="primary" (click)="nextStep()" [disabled]="isSubmitting">
                Next
              </app-button>
            }
            @if (currentStep === totalSteps) {
              <app-button type="submit" variant="primary" [loading]="isSubmitting" [disabled]="isSubmitting">
                @if (!isSubmitting) {
                  Submit Found Report
                }
              </app-button>
            }
          </div>
        </form>
      </app-card>
    }
  </div>
</div>
