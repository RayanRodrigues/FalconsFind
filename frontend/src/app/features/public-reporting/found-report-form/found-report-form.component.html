<div class="min-h-screen bg-neutral-base py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-semibold text-primary mb-2">Report Found Item</h1>
      <p class="text-text-secondary">Share details so Campus Security can validate and publish safely.</p>
    </div>

    @if (submitSuccess) {
      <app-card>
        <div class="text-center py-8">
          <svg
            class="w-16 h-16 text-success mx-auto mb-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z"
            />
          </svg>
          <h2 class="text-2xl font-semibold text-success mb-4">Found Report Submitted</h2>
          <p class="text-lg mb-2">Reference code:</p>
          <p class="text-3xl font-bold text-primary mb-6">{{ referenceCode }}</p>
          <div class="flex gap-4 justify-center">
            <app-button variant="primary" (click)="resetForm()">Submit Another Report</app-button>
            <app-button variant="secondary" (click)="navigateHome()">Return to Home</app-button>
          </div>
        </div>
      </app-card>
    }

    @if (submitError && !submitSuccess) {
      <div class="mb-6">
        <app-alert type="error" [dismissible]="true">
          <strong class="block mb-1">Could not submit found report</strong>
          <p class="text-sm">{{ submitError }}</p>
        </app-alert>
      </div>
    }

    @if (!submitSuccess) {
      <app-card cardTitle="Found Item Report" subtitle="Photo and location are required">
        <form [formGroup]="foundForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <app-report-steps [currentStep]="currentStep" />

          <p class="text-sm text-text-secondary pt-5"><span class="text-red-500">*</span> Required fields</p>

          @if (currentStep === 1) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">Basic Information</h3>

              <app-form-field id="title" label="Item Title" [required]="true" [error]="getFieldError('title')">
                <app-input
                  id="title"
                  formControlName="title"
                  placeholder="e.g., Silver Water Bottle"
                  [invalid]="isFieldInvalid('title')"
                />
              </app-form-field>

              <app-form-field id="description" label="Description" [required]="true" [error]="getFieldError('description')">
                <app-textarea
                  id="description"
                  formControlName="description"
                  [rows]="4"
                  placeholder="Describe color, brand, and identifying details"
                  [invalid]="isFieldInvalid('description')"
                />
                <span hint class="text-xs text-text-secondary">
                  {{ foundForm.get('description')?.value?.length || 0 }}/500 characters
                </span>
              </app-form-field>
            </div>
          }

          @if (currentStep === 2) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">When and Where</h3>

              <app-form-field
                id="foundLocation"
                label="Found Location"
                [required]="true"
                [error]="getFieldError('foundLocation')"
              >
                <app-input
                  id="foundLocation"
                  formControlName="foundLocation"
                  placeholder="e.g., Library, 2nd floor"
                  [invalid]="isFieldInvalid('foundLocation')"
                />
              </app-form-field>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <app-form-field id="foundDate" label="Date Found" [required]="true" [error]="getFieldError('foundDate')">
                  <app-input
                    id="foundDate"
                    type="date"
                    formControlName="foundDate"
                    [max]="todayDate"
                    [invalid]="isFieldInvalid('foundDate')"
                  />
                </app-form-field>

                <app-form-field id="foundTime" label="Approximate Time" [required]="true" [error]="getFieldError('foundTime')">
                  <app-input
                    id="foundTime"
                    type="time"
                    formControlName="foundTime"
                    [invalid]="isFieldInvalid('foundTime')"
                  />
                </app-form-field>
              </div>

              <app-photo-upload-field
                id="photos"
                inputId="photosInputFound"
                label="Photos"
                [required]="true"
                [error]="getFieldError('photos')"
                [photosCount]="foundForm.get('photos')?.value?.length || 0"
                [photoPreviewUrls]="photoPreviewUrls"
                (filesSelected)="onPhotosSelected($event)"
                (removePhoto)="removePhoto($event)"
              />
            </div>
          }

          @if (currentStep === 3) {
            <div class="space-y-4">
              <h3 class="text-lg font-semibold text-text-primary">Contact Information</h3>
              <p class="text-sm text-text-secondary">Optional. Helps campus security contact you quickly.</p>

              <app-form-field id="contactEmail" label="Email Address" [error]="getFieldError('contactEmail')">
                <app-input
                  id="contactEmail"
                  type="email"
                  formControlName="contactEmail"
                  placeholder="your.name@fanshaweonline.ca"
                  [invalid]="isFieldInvalid('contactEmail')"
                />
              </app-form-field>
            </div>
          }

          <div class="flex flex-row justify-end gap-3 pt-6 border-t border-border">
            <app-button type="button" variant="secondary" (click)="navigateHome()" [disabled]="isSubmitting">
              Cancel
            </app-button>
            @if (currentStep > 1) {
              <app-button type="button" variant="secondary" (click)="previousStep()" [disabled]="isSubmitting">
                Back
              </app-button>
            }
            @if (currentStep < totalSteps) {
              <app-button type="button" variant="primary" (click)="nextStep()" [disabled]="isSubmitting">
                Next
              </app-button>
            }
            @if (currentStep === totalSteps) {
              <app-button type="submit" variant="primary" [loading]="isSubmitting" [disabled]="isSubmitting">
                @if (!isSubmitting) {
                  Submit Found Report
                }
              </app-button>
            }
          </div>
        </form>
      </app-card>
    }
  </div>
</div>
