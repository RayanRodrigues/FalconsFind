<div class="min-h-screen bg-neutral-base py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-semibold text-primary mb-2">Report Lost Item</h1>
      <p class="text-text-secondary">Help us find your lost item by providing as much detail as possible</p>
    </div>

    <!-- Success State -->
    @if (submitSuccess) {
      <app-card>
        <div class="text-center py-8">
          <svg
            class="w-16 h-16 text-success mx-auto mb-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z"
            />
          </svg>
          <h2 class="text-2xl font-semibold text-success mb-4">Report Submitted Successfully!</h2>
          <p class="text-lg mb-2">Your reference code:</p>
          <p class="text-3xl font-bold text-primary mb-6">{{ referenceCode }}</p>
          <p class="text-text-secondary mb-8">
            Please save this code to check the status of your report.<br>
            Campus Security will review your report within 24-48 hours.
          </p>
          <div class="flex gap-4 justify-center">
            <app-button variant="primary" (click)="resetForm()">
              Submit Another Report
            </app-button>
            <app-button variant="secondary" (click)="navigateHome()">
              Return to Home
            </app-button>
          </div>
        </div>
      </app-card>
    }

    <!-- Error Alert -->
    @if (submitError && !submitSuccess) {
      <div class="mb-6">
        <app-alert type="error" [dismissible]="true">
          <strong class="block mb-1">Error submitting report</strong>
          <p class="text-sm">{{ submitError }}</p>
        </app-alert>
      </div>
    }

    <!-- Form -->
    @if (!submitSuccess) {
      <app-card cardTitle="Lost Item Report" subtitle="Please fill in all required fields">
        <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <div class="grid grid-cols-3 gap-2">
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 1 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg
                  class="h-4 w-4 shrink-0"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-8.25A2.25 2.25 0 0 0 17.25 3.75H6.75A2.25 2.25 0 0 0 4.5 6v12A2.25 2.25 0 0 0 6.75 20.25h6.75" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 8.25h7.5M8.25 11.25h7.5M8.25 14.25h4.5" />
                </svg>
                <span>Basic Info</span>
              </span>
            </button>
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 2 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg
                  class="h-4 w-4 shrink-0"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3.75v3M17.25 3.75v3M3.75 9.75h16.5" />
                  <rect x="3.75" y="5.25" width="16.5" height="15" rx="2.25" ry="2.25"></rect>
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 13.5h3.75" />
                </svg>
                <span>Time & Place</span>
              </span>
            </button>
            <button
              type="button"
              class="min-h-9 px-2 py-1 rounded-md border text-xs sm:text-sm leading-tight text-center whitespace-normal break-words font-medium transition-all"
              [ngClass]="currentStep === 3 ? 'border-primary text-primary bg-primary/5' : 'border-border text-text-secondary'"
            >
              <span class="inline-flex w-full items-center justify-center gap-1.5">
                <svg
                  class="h-4 w-4 shrink-0"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  aria-hidden="true"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6.75a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.5 19.5a7.5 7.5 0 0 1 15 0" />
                </svg>
                <span>Contact</span>
              </span>
            </button>
          </div>

          <p class="text-sm text-text-secondary">
            <span class="text-red-500">*</span> Required fields
          </p>

          @if (currentStep === 1) {
            <app-lost-report-step-basic
              [form]="reportForm"
              [categories]="categories"
              [getFieldError]="getFieldError.bind(this)"
              [isFieldInvalid]="isFieldInvalid.bind(this)"
            />
          }

          @if (currentStep === 2) {
            <app-lost-report-step-when-where
              [form]="reportForm"
              [locations]="locations"
              [todayDate]="todayDate"
              [getFieldError]="getFieldError.bind(this)"
              [isFieldInvalid]="isFieldInvalid.bind(this)"
            />
          }

          @if (currentStep === 3) {
          <app-lost-report-step-contact
            [form]="reportForm"
            [photoPreviewUrls]="photoPreviewUrls"
            [getFieldError]="getFieldError.bind(this)"
            [isFieldInvalid]="isFieldInvalid.bind(this)"
            [onFileSelected]="onFileSelected.bind(this)"
            [onRemovePhoto]="removePhoto.bind(this)"
            />
          }


          <div class="flex flex-row justify-end gap-3 pt-6 border-t border-border">
            <app-button 
              type="button" 
              variant="secondary" 
              (click)="navigateHome()"
              [disabled]="isSubmitting"
            >
              Cancel
            </app-button>
            @if (currentStep > 1) {
              <app-button
                type="button"
                variant="secondary"
                (click)="previousStep()"
                [disabled]="isSubmitting"
              >
                Back
              </app-button>
            }
            @if (currentStep < totalSteps) {
              <app-button
                type="button"
                variant="primary"
                (click)="nextStep()"
                [disabled]="isSubmitting"
              >
                Next
              </app-button>
            }
            @if (currentStep === totalSteps) {
            <app-button 
              type="submit" 
              variant="primary" 
              [loading]="isSubmitting"
              [disabled]="isSubmitting"
            >
              @if (!isSubmitting) {
                Submit Report
              }
            </app-button>
            }
          </div>
        </form>
      </app-card>
    }
  </div>
</div>
