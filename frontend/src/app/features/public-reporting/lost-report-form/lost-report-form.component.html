<div class="min-h-screen bg-neutral-base py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-3xl font-semibold text-primary mb-2">Report Lost Item</h1>
      <p class="text-text-secondary">Help us find your lost item by providing as much detail as possible</p>
    </div>

    <!-- Success State -->
    @if (submitSuccess) {
      <app-card>
        <div class="text-center py-8">
          <svg
            class="w-16 h-16 text-success mx-auto mb-6"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75 11.25 15 15 9.75M21 12A9 9 0 1 1 3 12a9 9 0 0 1 18 0Z"
            />
          </svg>
          <h2 class="text-2xl font-semibold text-success mb-4">Report Submitted Successfully!</h2>
          <p class="text-lg mb-2">Your reference code:</p>
          <p class="text-3xl font-bold text-primary mb-6">{{ referenceCode }}</p>
          <p class="text-text-secondary mb-8">
            Please save this code to reference your report.<br>
            Campus Security will review your report within 24-48 hours and contact you if your item is found.
          </p>
          <div class="flex gap-4 justify-center">
            <app-button variant="primary" (click)="resetForm()">
              Submit Another Report
            </app-button>
            <app-button variant="secondary" (click)="navigateHome()">
              Return to Home
            </app-button>
          </div>
        </div>
      </app-card>
    }

    <!-- Error Alert -->
    @if (submitError && !submitSuccess) {
      <div class="mb-6">
        <app-alert type="error" [dismissible]="true">
          <strong class="block mb-1">Error submitting report</strong>
          <p class="text-sm">{{ submitError }}</p>
        </app-alert>

        <div class="mt-3 flex gap-3">
          <app-button
            variant="primary"
            type="button"
            (click)="onSubmit()"
            [loading]="isSubmitting"
            [disabled]="isSubmitting"
          >
            Retry
          </app-button>

          <app-button
            variant="secondary"
            type="button"
            (click)="navigateHome()"
            [disabled]="isSubmitting"
          >
            Cancel
          </app-button>
        </div>
      </div>
    }

    <!-- Form -->
    @if (!submitSuccess) {
      <app-card cardTitle="Lost Item Report" subtitle="Please fill in all required fields">
        <form [formGroup]="reportForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <app-report-steps [currentStep]="currentStep" />

          <p class="text-sm text-text-secondary pt-5">
            <span class="text-red-500">*</span> Required fields
          </p>

          @if (currentStep === 1) {
            <app-lost-report-step-basic
              [form]="reportForm"
              [categories]="categories"
              [getFieldError]="getFieldError.bind(this)"
              [isFieldInvalid]="isFieldInvalid.bind(this)"
            />
          }

          @if (currentStep === 2) {
            <app-lost-report-step-when-where
              [form]="reportForm"
              [locations]="locations"
              [todayDate]="todayDate"
              [photoPreviewUrls]="photoPreviewUrls"
              [getFieldError]="getFieldError.bind(this)"
              [isFieldInvalid]="isFieldInvalid.bind(this)"
              [onPhotosSelected]="onPhotosSelected.bind(this)"
              [onRemovePhoto]="removePhoto.bind(this)"
            />
          }

          @if (currentStep === 3) {
            <app-lost-report-step-contact
              [form]="reportForm"
              [getFieldError]="getFieldError.bind(this)"
              [isFieldInvalid]="isFieldInvalid.bind(this)"
            />
          } 

          <div class="flex flex-row justify-end gap-3 pt-6 border-t border-border">
            <app-button 
              type="button" 
              variant="secondary" 
              (click)="navigateHome()"
              [disabled]="isSubmitting"
            >
              Cancel
            </app-button>
            @if (currentStep > 1) {
              <app-button
                type="button"
                variant="secondary"
                (click)="previousStep()"
                [disabled]="isSubmitting"
              >
                Back
              </app-button>
            }
            @if (currentStep < totalSteps) {
              <app-button
                type="button"
                variant="primary"
                (click)="nextStep()"
                [disabled]="isSubmitting"
              >
                Next
              </app-button>
            }
            @if (currentStep === totalSteps) {
            <app-button 
              type="submit" 
              variant="primary" 
              [loading]="isSubmitting"
              [disabled]="isSubmitting"
            >
              @if (!isSubmitting) {
                Submit Report
              }
            </app-button>
            }
          </div>
        </form>
      </app-card>
    }
  </div>
</div>
